#include <time.h>
#include <ctype.h>

#include "lib/libpe/error.h"
#include "pex.h"
#include "common.h"
#include "plugins.h"

parse_pe_ctx_t *parse_pe_load_file(char *path)
{
    int ret = PEX_E_OK;
    parse_pe_ctx_t *ctx = NULL;

    ctx = (parse_pe_ctx_t *)calloc(1, sizeof(parse_pe_ctx_t));
    if(NULL == ctx)
        goto error;
    
    ret = pe_load_file(&ctx->pe_ctx, path);
    if(PEX_E_OK != ret)
        goto error;
    
    return ctx;

error:
    parse_pe_free(ctx);
    return NULL;
}

int pex_parse_pe(parse_pe_ctx_t *ctx)
{
    int ret = PEX_E_OK;
    
    if(ctx == NULL)
        return PEX_E_NULL_PTR;

    ret = pe_parse(&ctx->pe_ctx);
    return ret;
}

void parse_pe_free(parse_pe_ctx_t *ctx)
{
    if(ctx == NULL)
        return;
    pe_unload(&ctx->pe_ctx);
    free(ctx);
}

