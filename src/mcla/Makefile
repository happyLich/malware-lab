SHELL=/bin/sh
# Where you want it installed when you do 'make install'
PREFIX=/usr/local/
PECKER_INC_SRC=/root/src/lib/
PECKER_CFLAGS_NOERR:=-I/usr/include\
    -pipe -fPIC -O0 -fno-strict-aliasing -fno-common -g -std=c99
PECKER_CXXFLAGS_NOERR:=-I/usr/include\
    -pipe -fPIC -O0 -fno-strict-aliasing -fno-common -g

GCC = g++

TARGET=all
MCLA_LD_FLAGS += -L/usr/local/lib -lbase -lsvm -lpex `pkg-config --cflags opencv` `pkg-config --libs opencv`
MCLA_TEST_LD_FLAGS += -L/usr/local/lib -lbase -lmcla
MCLA_APP_TRAIN_LD_FLAGS += -L/usr/local/lib -lbase -lmcla
CFLAGS += ${PECKER_CFLAGS_NOERR} -I/usr/local/include -I../../lib/pex/include -I../../lib/pex/src -I${PECKER_INC_SRC}
CXXFLAGS += ${PECKER_CXXFLAGS_NOERR} -I/usr/local/include -I../../lib/pex/include -I../../lib/pex/src -I${PECKER_INC_SRC}

all:libmcla mcla_test mcla_train

MCLA_LIB_OBJS = pecker_mcla.o pecker_mcla_svm.o pecker_mcla_img.o pecker_mcla_train.o pecker_mcla_pe.o
MCLA_TEST_OBJS = pecker_mcla_test.o
MCLA_APP_TRAIN_OBJS = pecker_mcla_app_train.o

libmcla: $(MCLA_LIB_OBJS)
	$(CC) $(MCLA_LIB_OBJS) $(MCLA_LD_FLAGS) -shared -o libmcla.so
	cp libmcla.so /usr/local/lib
	cp libmcla.so /lib

mcla_test: $(MCLA_TEST_OBJS)
	$(CC) $(MCLA_TEST_OBJS) $(MCLA_TEST_LD_FLAGS) -o mcla_test

mcla_train: $(MCLA_APP_TRAIN_OBJS)
	$(CC) $(MCLA_APP_TRAIN_OBJS) $(MCLA_APP_TRAIN_LD_FLAGS) -o mcla_train

install:
	cp mcla_train /usr/local/bin/mcla_train

%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

%.o: %.cpp
	$(GCC) $(CXXFLAGS) -c $< -o $@

clean:
	rm -f mcla_test mcla_train *.o *.so
