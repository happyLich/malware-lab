SHELL=/bin/sh
# Where you want it installed when you do 'make install'
PREFIX=/usr/local/
PECKER_INC_SRC=/root/src/lib/
PECKER_CFLAGS_NOERR:=-I/usr/include\
    -pipe -fPIC -O0 -fno-strict-aliasing -fno-common -g -std=c99
PECKER_CXXFLAGS_NOERR:=-I/usr/include\
    -pipe -fPIC -O0 -fno-strict-aliasing -fno-common -g

GCC = g++

TARGET=all
MCLA_LD_FLAGS += -L/usr/local/lib -lbase -lsvm -lpex `pkg-config --cflags opencv` `pkg-config --libs opencv`
MCLA_TEST_LD_FLAGS += -L/usr/local/lib -lbase -lmcla
MCLA_APP_TRAIN_LD_FLAGS += -L/usr/local/lib -lbase -lmcla
MCLA_SER_LD_FLAGS += -L/usr/local/lib -lpthread -lconfig -lbase -lmcla
MCLA_CLI_LD_FLAGS += -L/usr/local/lib -lbase -lmcla
CFLAGS += ${PECKER_CFLAGS_NOERR} -I/usr/local/include -I../../lib/pex/include -I../../lib/pex/src -I${PECKER_INC_SRC}
CXXFLAGS += ${PECKER_CXXFLAGS_NOERR} -I/usr/local/include -I../../lib/pex/include -I../../lib/pex/src -I${PECKER_INC_SRC}

all:libmcla mcla_ser mcla_cli mcla_test mcla_train

MCLA_LIB_OBJS = pecker_mcla.o pecker_mcla_svm.o pecker_mcla_img.o pecker_mcla_train.o pecker_mcla_pe.o
MCLA_TEST_OBJS = pecker_mcla_test.o
MCLA_APP_TRAIN_OBJS = pecker_mcla_app_train.o
MCLA_SER_OBJS = pecker_mcla_ser.o
MCLA_CLI_OBJS = pecker_mcla_cli.o

libmcla: $(MCLA_LIB_OBJS)
	$(CC) $(MCLA_LIB_OBJS) $(MCLA_LD_FLAGS) -shared -o libmcla.so
	cp libmcla.so /usr/local/lib
	cp libmcla.so /lib

mcla_test: $(MCLA_TEST_OBJS)
	$(CC) $(MCLA_TEST_OBJS) $(MCLA_TEST_LD_FLAGS) -o mcla_test

mcla_train: $(MCLA_APP_TRAIN_OBJS)
	$(CC) $(MCLA_APP_TRAIN_OBJS) $(MCLA_APP_TRAIN_LD_FLAGS) -o mcla_train

mcla_ser: $(MCLA_SER_OBJS)
	$(CC) $(MCLA_SER_OBJS) $(MCLA_SER_LD_FLAGS) -o mcla_ser

mcla_cli: $(MCLA_CLI_OBJS)
	$(CC) $(MCLA_CLI_OBJS) $(MCLA_CLI_LD_FLAGS) -o mcla_cli

install:
	cp mcla_train /usr/local/bin/mcla_train
	cp mcla_test /usr/local/bin/mcla_test
	cp mcla_ser /usr/local/bin/mcla_ser
	cp mcla_cli /usr/local/bin/mcla_cli

uninstall:
	rm -f /usr/local/bin/mcla_train
	rm -f /usr/local/bin/mcla_test
	rm -f /usr/local/bin/mcla_ser
	rm -f /usr/local/bin/mcla_cli
	rm -f /usr/local/lib/libmcla.so
	rm -f /lib/libmcla.so

%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

%.o: %.cpp
	$(GCC) $(CXXFLAGS) -c $< -o $@

clean:
	rm -f mcla_test mcla_train mcla_ser mcla_cli *.o *.so
