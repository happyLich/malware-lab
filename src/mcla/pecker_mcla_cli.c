#include <base/pecker.h>
#include <dirent.h>
#include <getopt.h>

#define DEAD_CODE 0
#define MCLA_CLIENT_HELP  \
    "Usage: %s [OPTION...] [STRING...]\n\n" \
    "    -h, --help                      display this help and exit\n\n"\
    "    -r, --read-img                  test function of read image\n"\
    "    -w, --write-img                 test function of write image\n"\
    "    -g, --glcm                      test function of calc glcm value\n"\
    "    -s, --scan-pe                   scan PE file and check malware\n\n"\

static char *progname;     /* used throughout */
static int opt;
static struct option longopts[] = {
    {"help", 0, NULL, 'h'},
    {"read-img", 1, NULL, 'r'},
    {"write-img", 1, NULL, 'w'},
    {"glcm", 1, NULL, 'g'},
    {"scan-pe", 1, NULL, 's'},
    {0,0,0,0}
};

void mcla_client_help(void);

int main(int argc, char **argv)
{
    int ret = 0;
    int helpinfo = 1;
    
    if ((progname = strrchr(argv[0], '/')) != NULL)
        progname++;
    else
        progname = argv[0];

    while((opt = getopt_long(argc, argv, "hg:r:w:s:", longopts, NULL)) != -1)
    {
        switch(opt)
        {
            case 'r':
                helpinfo = 0;
                break;
            case 'w':
                helpinfo = 0;
                break;
            case 'g':
                helpinfo = 0;
                break;
            case 's':
                helpinfo = 0;
                break;
            case 'h':
                helpinfo++;
                break;
            case '?':
                helpinfo++;
                break;
            default:
                helpinfo++;
                break;
        }
    }
    
    if(helpinfo)
        mcla_client_help();
        
    return ret;
}

void mcla_client_help(void)
{
    (void)fprintf(stderr, MCLA_CLIENT_HELP, progname);
    exit(1);
}

