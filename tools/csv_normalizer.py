#coding=utf-8

import pandas as pd
from collections import *
import sys

arg = sys.argv
if len(arg) < 3:
    print "Usage: python csv_normalizer src_path dst_path!"
    exit()
src_path = arg[1]
dst_path = arg[2]

csv_data = pd.read_csv(src_path)

colnames = csv_data.columns
col_mean = defaultdict(list)
col_max = defaultdict(list)
col_min = defaultdict(list)
lables = csv_data['lable']
df = pd.DataFrame(lables)

for colname in colnames:
    if colname != 'lable':
        column = csv_data[colname]
        col_mean[colname] = column.mean()
        col_max[colname] = column.max()
        col_min[colname] = column.min()

for colname in colnames:
    if colname != 'lable':
        column = csv_data[colname]
        column = [(x - col_mean[colname])/(col_max[colname] - col_min[colname]) for x in column]
        tmp_df = pd.DataFrame({colname:column})
        df = df.join(tmp_df)

df.to_csv(dst_path,index=False)

if len(arg) > 3:
    para_path = arg[3]
    fw = open(para_path,'w')
    fw.write('#name,mean,max,min,max-min\n')
    for colname in colnames:
        if colname != 'lable':
            fw.write('%s,%f,%f,%f,%f\n'%(colname,col_mean[colname],col_max[colname],col_min[colname],col_max[colname]-col_min[colname]))
    fw.close()

print "success"
