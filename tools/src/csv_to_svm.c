#include <base/pecker.h>

int main(int argc, char **argv)
{
    int ret = 0;
    FILE *fpr = NULL, *fpw = NULL;
    uint8_t buf[65535] = "";
    uint8_t *ptr;
    int lable;
    
    if(argc < 3)
    {
        printf("Usage: ./csv_to_svm src_file dst_file...\n");
        goto exit;
    }
    
    fpr = fopen(argv[1], "r");
    if(NULL == fpr)
    {
        printf("open file %s failed\n", argv[1]);
        goto exit;
    }
    
    fpw = fopen(argv[2], "w");
    if(NULL == fpr)
    {
        printf("open file %s failed\n", argv[2]);
        goto exit;
    }

    int i = 1;
    double val;
    while(fgets(buf, 65534, fpr))
    {
        if(!isdigit(buf[0]))
            continue;
        lable = atoi(buf);
        fprintf(fpw, "%d ", lable);
        i = 1;
        ptr = buf;
        while((ptr = strchr(ptr, ',')) != NULL)
        {
            ptr++;
            val = atof(ptr);
            fprintf(fpw, "%d:%.2f ", i, val);
            i++;
        }
        
        fprintf(fpw, "\n");
    }
    
exit:
    if(fpr)
        fclose(fpr);
    if(fpw)
        fclose(fpw);
    return ret;
}

